<html>
	<head>
		<title>Boids.js</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="js/three.min.js"></script>
		<script src="js/stats.js"></script>
		<script src="js/OrbitControls.js"></script>
		<script src="js/Detector.js"></script>
		
		<script src="js/Vector.js"></script>
		<script src="js/Boid.js"></script>
		<script>

var camera, controls, scene, renderer, loader, stats, boids, bgroup, goahead;

goahead = false;

init();
render();

function animate() {
	requestAnimationFrame(animate);
	controls.update();
	render();
}

function init() {
	var pos = new Vector(1, 3, 4);
	var vel = new Vector(12, 32, 42);
	var rot = new Vector(4, 5, 7);
	var b = new Boid(pos, vel, rot);
	
	console.log(b.pos.x + " " + b.vel.y + " " + b.rot.z);
	
	camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
	camera.position.z = 100;

	controls = new THREE.OrbitControls(camera);
	controls.damping = 0.2;
    controls.addEventListener('change', render);

	scene = new THREE.Scene();
	scene.fog = new THREE.FogExp2(0xcccccc, 0.001);

	boids = [];
	bgroup = new THREE.Group();
	loader = new THREE.JSONLoader();
	loader.load('models/ball.json', function (geometry) {
		THREE.GeometryUtils.center(geometry);
		var material = new THREE.MeshLambertMaterial({color: 0xcc4444});
		
		for(var i = 0; i != 500; i++) {
			mesh = new THREE.Mesh(geometry, material);
			
			var posx = Math.random() * 100 - 50;
			var posy = Math.random() * 100 - 50;
			var posz = Math.random() * 100 - 50;
			
			var rotx = 0;
			var roty = 0;
			var rotz = 0;
			
			var pos = new Vector(posx, posy, posz);
			var rot = new Vector(rotx, roty, rotz);
			var vel = new Vector(0, 0, 0);
			
			mesh.position.x = pos.x;
			mesh.position.y = pos.y;
			mesh.position.z = pos.z;
			
			mesh.rotation.x = rot.x;
			mesh.rotation.y = rot.y;
			mesh.rotation.z = rot.z;
			
			var boid = new Boid(pos, rot, vel);
			
			boids.push(boid);
			bgroup.add(mesh);
			
			if(i == 99) {
				goahead = true;
			}
		}
	});
	
	scene.add(bgroup);
	
	var light1 = new THREE.DirectionalLight(0xeeeeee);
	light1.position.x = Math.random() - 0.5;
	light1.position.y = Math.random() - 0.5;
	light1.position.z = Math.random() - 0.5;
	light1.position.normalize();
	light1.intensity = 1.5;
	scene.add(light1);
	
	var light2 = new THREE.DirectionalLight(0xeeeeee);
	light2.position.x = Math.random() - 0.5;
	light2.position.y = Math.random() - 0.5;
	light2.position.z = Math.random() - 0.5;
	light2.position.normalize();
	light2.intensity = 1.5;
	scene.add(light2);
	
	renderer = new THREE.WebGLRenderer();
	renderer.setClearColor(scene.fog.color);
	renderer.setPixelRatio(window.devicePixelRatio);
	renderer.setSize(window.innerWidth, window.innerHeight);
	document.body.appendChild(renderer.domElement);

	stats = new Stats();
	stats.domElement.style.position = 'absolute';
	stats.domElement.style.left = '0px';
	stats.domElement.style.bottom = '0px';
	document.body.appendChild(stats.domElement);
	
	window.addEventListener('resize', onWindowResize, false);

	animate();
}

function onWindowResize() {
	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();

	renderer.setSize(window.innerWidth, window.innerHeight);

	//render();
}

function render() {
	renderer.render(scene, camera);
	stats.update();
	
	if(goahead) {
		for(var i = 0; i != bgroup.children.length; i++) {
			boids[i].update(boids);
			
			bgroup.children[i].position.x = boids[i].pos.x;
			bgroup.children[i].position.y = boids[i].pos.y;
			bgroup.children[i].position.z = boids[i].pos.z;
			
			bgroup.children[i].rotation.x = boids[i].rot.x;
			bgroup.children[i].rotation.y = boids[i].rot.y;
			bgroup.children[i].rotation.z = boids[i].rot.z;
		}
	}
}


		</script>
		
	</body>
	</head>
</html>